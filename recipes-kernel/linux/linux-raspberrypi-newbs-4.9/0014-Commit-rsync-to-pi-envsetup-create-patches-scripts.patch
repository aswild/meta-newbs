From d08a2d213e6dfa67328b4a98eda788920851486d Mon Sep 17 00:00:00 2001
From: Allen Wild <allenwild93@gmail.com>
Date: Tue, 14 Mar 2017 21:15:00 -0400
Subject: [PATCH 14/20] Commit rsync-to-pi, envsetup, create-patches scripts

---
 scripts/create-patches.sh |  8 ++++++++
 scripts/envsetup.sh       |  5 +++++
 scripts/rsync-to-pi.sh    | 35 +++++++++++++++++++++++++++++++++++
 3 files changed, 48 insertions(+)
 create mode 100755 scripts/create-patches.sh
 create mode 100644 scripts/envsetup.sh
 create mode 100755 scripts/rsync-to-pi.sh

diff --git a/scripts/create-patches.sh b/scripts/create-patches.sh
new file mode 100755
index 0000000..2e9283e
--- /dev/null
+++ b/scripts/create-patches.sh
@@ -0,0 +1,8 @@
+#!/bin/bash
+
+[[ -n "$NEWBS_FILES" ]] || NEWBS_FILES=./newbs-files
+
+set -x
+git format-patch $(git merge-base HEAD origin/rpi-4.9.y) --output-directory "$NEWBS_FILES" \
+    | sed "s|$NEWBS_FILES/|patch |" \
+    | tee "$NEWBS_FILES/shiftbrite-patches.scc"
diff --git a/scripts/envsetup.sh b/scripts/envsetup.sh
new file mode 100644
index 0000000..347bf42
--- /dev/null
+++ b/scripts/envsetup.sh
@@ -0,0 +1,5 @@
+export ARCH=arm
+export CROSS_COMPILE=arm-linux-gnueabihf-
+export MAKEFLAGS=-j4
+export INSTALL_HDR_PATH=HEADERS_INSTALL
+export INSTALL_MOD_PATH=MODULES_INSTALL
diff --git a/scripts/rsync-to-pi.sh b/scripts/rsync-to-pi.sh
new file mode 100755
index 0000000..8d99125
--- /dev/null
+++ b/scripts/rsync-to-pi.sh
@@ -0,0 +1,35 @@
+#!/bin/bash -e
+
+USER=root
+#IP=192.168.0.212
+IP=10.11.0.2
+
+RSYNC_OPTS=-tlv
+
+if [[ $# > 0 ]]; then
+    while [[ -n $1 ]]; do
+        case $1 in
+            sb|shiftbrite)
+                kernelname=$(ssh $USER@$IP 'uname -r')
+                rsync $RSYNC_OPTS drivers/spi/shiftbrite.ko \
+                      $USER@$IP:/lib/modules/$kernelname/kernel/drivers/spi/shiftbrite.ko
+            ;;
+            ns|neostrip)
+                kernelname=$(ssh $USER@$IP 'uname -r')
+                rsync $RSYNC_OPTS drivers/spi/neostrip.ko \
+                      $USER@$IP:/lib/modules/$kernelname/kernel/drivers/spi/neostrip.ko
+            ;;
+            dto)
+                rsync $RSYNC_OPTS arch/arm/boot/dts/overlays/pi3-spi-shiftbrite.dtbo \
+                      $USER@$IP:/boot/overlays/pi3-spi-shiftbrite.dtbo
+        esac
+        shift
+    done
+else
+    make ARCH=arm CROSS_COMPILE=/opt/gcc-linaro-6.2.1-2016.11-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf- \
+         INSTALL_MOD_PATH=MODULES_INSTALL modules_install
+    rsync $RSYNC_OPTS arch/arm/boot/zImage $USER@$IP:/boot/kernel7.img
+    rsync $RSYNC_OPTS arch/arm/boot/dts/*.dtb $USER@$IP:/boot/
+    rsync $RSYNC_OPTS arch/arm/boot/dts/overlays/*.dtb* $USER@$IP:/boot/overlays/
+    rsync $RSYNC_OPTS -r MODULES_INSTALL/ $USER@$IP:/
+fi
-- 
2.9.3

